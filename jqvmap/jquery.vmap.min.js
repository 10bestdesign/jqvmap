/*!
 * jQVMap Version 1.0 
 *
 * http://jqvmap.com
 *
 * Copyright 2012, Peter Schmalfeldt <manifestinteractive@gmail.com>
 * Copyright 2011-2012, Kirill Lebedev
 * Licensed under the MIT license.
 *
 * Fork Me @ https://github.com/manifestinteractive/jqvmap
 */
(function($){var apiParams={colors:1,values:1,backgroundColor:1,scaleColors:1,normalizeFunction:1,enableZoom:1,showTooltip:1,borderColor:1,borderWidth:1,borderOpacity:1,selectedRegions:1,multiSelectRegion:1};var apiEvents={onLabelShow:"labelShow",onRegionOver:"regionMouseOver",onRegionOut:"regionMouseOut",onRegionClick:"regionClick",onRegionSelect:"regionSelect",onRegionDeselect:"regionDeselect"};$.fn.vectorMap=function(e){var t={map:"world_en",backgroundColor:"#a5bfdd",color:"#f4f3f0",hoverColor:"#c9dfaf",selectedColor:"#c9dfaf",scaleColors:["#b6d6ff","#005ace"],normalizeFunction:"linear",enableZoom:true,showTooltip:true,borderColor:"#818181",borderWidth:1,borderOpacity:.25,selectedRegions:null,multiSelectRegion:false},n=this.data("mapObject");if(e==="addMap"){WorldMap.maps[arguments[1]]=arguments[2]}else if(e==="set"&&apiParams[arguments[1]]){n["set"+arguments[1].charAt(0).toUpperCase()+arguments[1].substr(1)].apply(n,Array.prototype.slice.call(arguments,2))}else if(typeof e==="string"&&typeof n[e]==="function"){return n[e].apply(n,Array.prototype.slice.call(arguments,1))}else{$.extend(t,e);t.container=this;this.css({position:"relative",overflow:"hidden"});n=new WorldMap(t);this.data("mapObject",n);for(var r in apiEvents){if(t[r]){this.bind(apiEvents[r]+".jqvmap",t[r])}}}};var VectorCanvas=function(e,t,n){this.mode=window.SVGAngle?"svg":"vml";this.params=n;if(this.mode=="svg"){this.createSvgNode=function(e){return document.createElementNS(this.svgns,e)}}else{try{if(!document.namespaces.rvml){document.namespaces.add("rvml","urn:schemas-microsoft-com:vml")}this.createVmlNode=function(e){return document.createElement("<rvml:"+e+' class="rvml">')}}catch(r){this.createVmlNode=function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)")}if(this.mode=="svg"){this.canvas=this.createSvgNode("svg")}else{this.canvas=this.createVmlNode("group");this.canvas.style.position="absolute"}this.setSize(e,t)};VectorCanvas.prototype={svgns:"http://www.w3.org/2000/svg",mode:"svg",width:0,height:0,canvas:null,setSize:function(e,t){if(this.mode=="svg"){this.canvas.setAttribute("width",e);this.canvas.setAttribute("height",t)}else{this.canvas.style.width=e+"px";this.canvas.style.height=t+"px";this.canvas.coordsize=e+" "+t;this.canvas.coordorigin="0 0";if(this.rootGroup){var n=this.rootGroup.getElementsByTagName("shape");for(var r=0,i=n.length;r<i;r++){n[r].coordsize=e+" "+t;n[r].style.width=e+"px";n[r].style.height=t+"px"}this.rootGroup.coordsize=e+" "+t;this.rootGroup.style.width=e+"px";this.rootGroup.style.height=t+"px"}}this.width=e;this.height=t},createPath:function(e){var t;if(this.mode=="svg"){t=this.createSvgNode("path");t.setAttribute("d",e.path);if(this.params.borderColor!==null){t.setAttribute("stroke",this.params.borderColor)}if(this.params.borderWidth>0){t.setAttribute("stroke-width",this.params.borderWidth);t.setAttribute("stroke-linecap","round");t.setAttribute("stroke-linejoin","round")}if(this.params.borderOpacity>0){t.setAttribute("stroke-opacity",this.params.borderOpacity)}t.setFill=function(e){this.setAttribute("fill",e);if(this.getAttribute("original")===null){this.setAttribute("original",e)}};t.getFill=function(e){return this.getAttribute("fill")};t.getOriginalFill=function(){return this.getAttribute("original")};t.setOpacity=function(e){this.setAttribute("fill-opacity",e)}}else{t=this.createVmlNode("shape");t.coordorigin="0 0";t.coordsize=this.width+" "+this.height;t.style.width=this.width+"px";t.style.height=this.height+"px";t.fillcolor=WorldMap.defaultFillColor;t.stroked=false;t.path=VectorCanvas.pathSvgToVml(e.path);var n=this.createVmlNode("skew");n.on=true;n.matrix="0.01,0,0,0.01,0,0";n.offset="0,0";t.appendChild(n);var r=this.createVmlNode("fill");t.appendChild(r);t.setFill=function(e){this.getElementsByTagName("fill")[0].color=e;if(this.getAttribute("original")===null){this.setAttribute("original",e)}};t.getFill=function(e){return this.getElementsByTagName("fill")[0].color};t.getOriginalFill=function(){return this.getAttribute("original")};t.setOpacity=function(e){this.getElementsByTagName("fill")[0].opacity=parseInt(e*100,10)+"%"}}return t},createGroup:function(e){var t;if(this.mode=="svg"){t=this.createSvgNode("g")}else{t=this.createVmlNode("group");t.style.width=this.width+"px";t.style.height=this.height+"px";t.style.left="0px";t.style.top="0px";t.coordorigin="0 0";t.coordsize=this.width+" "+this.height}if(e){this.rootGroup=t}return t},applyTransformParams:function(e,t,n){if(this.mode=="svg"){this.rootGroup.setAttribute("transform","scale("+e+") translate("+t+", "+n+")")}else{this.rootGroup.coordorigin=this.width-t+","+(this.height-n);this.rootGroup.coordsize=this.width/e+","+this.height/e}}};VectorCanvas.pathSvgToVml=function(e){var t="";var n=0,r=0,i,s;return e.replace(/([MmLlHhVvCcSs])((?:-?(?:\d+)?(?:\.\d+)?,?\s?)+)/g,function(e,t,o,u){o=o.replace(/(\d)-/g,"$1,-").replace(/\s+/g,",").split(",");if(!o[0]){o.shift()}for(var a=0,f=o.length;a<f;a++){o[a]=Math.round(100*o[a])}switch(t){case"m":n+=o[0];r+=o[1];return"t"+o.join(",");break;case"M":n=o[0];r=o[1];return"m"+o.join(",");break;case"l":n+=o[0];r+=o[1];return"r"+o.join(",");break;case"L":n=o[0];r=o[1];return"l"+o.join(",");break;case"h":n+=o[0];return"r"+o[0]+",0";break;case"H":n=o[0];return"l"+n+","+r;break;case"v":r+=o[0];return"r0,"+o[0];break;case"V":r=o[0];return"l"+n+","+r;break;case"c":i=n+o[o.length-4];s=r+o[o.length-3];n+=o[o.length-2];r+=o[o.length-1];return"v"+o.join(",");break;case"C":i=o[o.length-4];s=o[o.length-3];n=o[o.length-2];r=o[o.length-1];return"c"+o.join(",");break;case"s":o.unshift(r-s);o.unshift(n-i);i=n+o[o.length-4];s=r+o[o.length-3];n+=o[o.length-2];r+=o[o.length-1];return"v"+o.join(",");break;case"S":o.unshift(r+r-s);o.unshift(n+n-i);i=o[o.length-4];s=o[o.length-3];n=o[o.length-2];r=o[o.length-1];return"c"+o.join(",");break;default:return false;break}return""}).replace(/z/g,"")};var WorldMap=function(e){e=e||{};var t=this;var n=WorldMap.maps[e.map];this.selectedRegions=[];this.multiSelectRegion=e.multiSelectRegion;this.container=e.container;this.defaultWidth=n.width;this.defaultHeight=n.height;this.color=e.color;this.selectedColor=e.selectedColor;this.hoverColor=e.hoverColor;this.hoverOpacity=e.hoverOpacity;this.setBackgroundColor(e.backgroundColor);this.width=e.container.width();this.height=e.container.height();this.resize();jQuery(window).resize(function(){t.width=e.container.width();t.height=e.container.height();t.resize();t.canvas.setSize(t.width,t.height);t.applyTransform()});this.canvas=new VectorCanvas(this.width,this.height,e);e.container.append(this.canvas.canvas);this.makeDraggable();this.rootGroup=this.canvas.createGroup(true);this.index=WorldMap.mapIndex;this.label=jQuery("<div/>").addClass("jqvmap-label").appendTo(jQuery("body")).hide();if(e.enableZoom){jQuery("<div/>").addClass("jqvmap-zoomin").text("+").appendTo(e.container);jQuery("<div/>").addClass("jqvmap-zoomout").html("&#x2212;").appendTo(e.container)}t.countries=[];for(var r in n.pathes){var i=this.canvas.createPath({path:n.pathes[r].path});i.setFill(this.color);i.id=t.getCountryId(r);t.countries[r]=i;if(this.canvas.mode=="svg"){i.setAttribute("class","jvectormap-region")}else{jQuery(i).addClass("jvectormap-region")}jQuery(this.rootGroup).append(i)}jQuery(e.container).delegate(this.canvas.mode=="svg"?"path":"shape","mouseover mouseout",function(r){var i=r.target,s=r.target.id.split("_").pop(),o=$.Event("labelShow.jqvmap"),u=$.Event("regionMouseOver.jqvmap");if(r.type=="mouseover"){jQuery(e.container).trigger(u,[s,n.pathes[s].name]);if(!u.isDefaultPrevented()){t.highlight(s,i)}if(e.showTooltip){t.label.text(n.pathes[s].name);jQuery(e.container).trigger(o,[t.label,s]);if(!o.isDefaultPrevented()){t.label.show();t.labelWidth=t.label.width();t.labelHeight=t.label.height()}}}else{t.unhighlight(s,i);t.label.hide();jQuery(e.container).trigger("regionMouseOut.jqvmap",[s,n.pathes[s].name])}});jQuery(e.container).delegate(this.canvas.mode=="svg"?"path":"shape","click",function(r){if(!e.multiSelectRegion){for(var i in n.pathes){t.countries[i].currentFillColor=t.countries[i].getOriginalFill();t.countries[i].setFill(t.countries[i].getOriginalFill())}}var s=r.target;var o=r.target.id.split("_").pop();jQuery(e.container).trigger("regionClick.jqvmap",[o,n.pathes[o].name]);if(!regionClickEvent.isDefaultPrevented()){if(t.selectedRegions.indexOf(o)!==-1){t.deselect(o,s)}else{t.select(o,s)}}});if(e.showTooltip){e.container.mousemove(function(e){if(t.label.is(":visible")){var n=e.pageX-15-t.labelWidth;var r=e.pageY-15-t.labelHeight;if(n<0)n=e.pageX+15;if(r<0)r=e.pageY+15;t.label.css({left:n,top:r})}})}this.canvas.canvas.appendChild(this.rootGroup);this.applyTransform();this.colorScale=new ColorScale(e.scaleColors,e.normalizeFunction,e.valueMin,e.valueMax);if(e.values){this.values=e.values;this.setValues(e.values)}this.setColors(e.colors);if(e.selectedRegions){if(e.selectedRegions instanceof Array){for(var s in e.selectedRegions){this.select(e.selectedRegions[s].toLowerCase())}}else{this.select(e.selectedRegions.toLowerCase())}}this.bindZoomButtons();if(e.pins){this.pinHandlers=false;this.placePins(e.pins,e.pinMode)}WorldMap.mapIndex++};WorldMap.prototype={transX:0,transY:0,scale:1,baseTransX:0,baseTransY:0,baseScale:1,width:0,height:0,countries:{},countriesColors:{},countriesData:{},zoomStep:1.4,zoomMaxStep:4,zoomCurStep:1,setColors:function(e,t){if(typeof e=="string"){this.countries[e].setFill(t);this.countries[e].setAttribute("original",t)}else{var n=e;for(var r in n){if(this.countries[r]){this.countries[r].setFill(n[r]);this.countries[r].setAttribute("original",n[r])}}}},setValues:function(e){var t=0,n=Number.MAX_VALUE,r;for(var i in e){r=parseFloat(e[i]);if(r>t){t=e[i]}if(r&&r<n){n=r}}this.colorScale.setMin(n);this.colorScale.setMax(t);var s={};for(i in e){r=parseFloat(e[i]);if(r){s[i]=this.colorScale.getColor(r)}else{s[i]=this.color}}this.setColors(s);this.values=e},setBackgroundColor:function(e){this.container.css("background-color",e)},setScaleColors:function(e){this.colorScale.setColors(e);if(this.values){this.setValues(this.values)}},setNormalizeFunction:function(e){this.colorScale.setNormalizeFunction(e);if(this.values){this.setValues(this.values)}},highlight:function(e,t){t=t||$("#"+this.getCountryId(e))[0];if(this.hoverOpacity){t.setOpacity(this.hoverOpacity)}else if(this.hoverColor){t.currentFillColor=t.getFill()+"";t.setFill(this.hoverColor)}},unhighlight:function(e,t){t=t||$("#"+this.getCountryId(e))[0];t.setOpacity(1);if(t.currentFillColor){t.setFill(t.currentFillColor)}},select:function(e,t){t=t||$("#"+this.getCountryId(e))[0];if(this.selectedRegions.indexOf(e)<0){if(this.multiSelectRegion){this.selectedRegions.push(e)}else{this.selectedRegions=[e]}$(this.container).trigger("regionSelect.jqvmap",[e]);if(this.selectedColor){t.currentFillColor=this.selectedColor;t.setFill(this.selectedColor)}}},deselect:function(e,t){t=t||$("#"+this.getCountryId(e))[0];if(this.selectedRegions.indexOf(e)>=0){this.selectedRegions.splice(this.selectedRegions.indexOf(e),1);$(this.container).trigger("regionDeselect.jqvmap",[e]);t.currentFillColor=t.getOriginalFill();t.setFill(t.getOriginalFill())}},isSelected:function(e){return this.selectedRegions.indexOf(e)>=0},resize:function(){var e=this.baseScale;if(this.width/this.height>this.defaultWidth/this.defaultHeight){this.baseScale=this.height/this.defaultHeight;this.baseTransX=Math.abs(this.width-this.defaultWidth*this.baseScale)/(2*this.baseScale)}else{this.baseScale=this.width/this.defaultWidth;this.baseTransY=Math.abs(this.height-this.defaultHeight*this.baseScale)/(2*this.baseScale)}this.scale*=this.baseScale/e;this.transX*=this.baseScale/e;this.transY*=this.baseScale/e},reset:function(){this.countryTitle.reset();for(var e in this.countries){this.countries[e].setFill(WorldMap.defaultColor)}this.scale=this.baseScale;this.transX=this.baseTransX;this.transY=this.baseTransY;this.applyTransform()},applyTransform:function(){var e,t,n,r;if(this.defaultWidth*this.scale<=this.width){e=(this.width-this.defaultWidth*this.scale)/(2*this.scale);n=(this.width-this.defaultWidth*this.scale)/(2*this.scale)}else{e=0;n=(this.width-this.defaultWidth*this.scale)/this.scale}if(this.defaultHeight*this.scale<=this.height){t=(this.height-this.defaultHeight*this.scale)/(2*this.scale);r=(this.height-this.defaultHeight*this.scale)/(2*this.scale)}else{t=0;r=(this.height-this.defaultHeight*this.scale)/this.scale}if(this.transY>t){this.transY=t}else if(this.transY<r){this.transY=r}if(this.transX>e){this.transX=e}else if(this.transX<n){this.transX=n}this.canvas.applyTransformParams(this.scale,this.transX,this.transY)},makeDraggable:function(){var e=false;var t,n;var r=this;r.isMoving=false;r.isMovingTimeout=false;this.container.mousemove(function(i){if(e){var s=r.transX;var o=r.transY;r.transX-=(t-i.pageX)/r.scale;r.transY-=(n-i.pageY)/r.scale;r.applyTransform();t=i.pageX;n=i.pageY;r.isMoving=true;if(r.isMovingTimeout){clearTimeout(r.isMovingTimeout)}r.container.trigger("drag")}return false}).mousedown(function(r){e=true;t=r.pageX;n=r.pageY;return false}).mouseup(function(){e=false;r.isMovingTimeout=setTimeout(function(){r.isMoving=false},100);return false})},bindZoomButtons:function(){var e=this;this.container.find(".jqvmap-zoomin").click(function(){e.zoomIn()});this.container.find(".jqvmap-zoomout").click(function(){e.zoomOut()})},zoomIn:function(){var e=this;var t=(jQuery("#zoom").innerHeight()-6*2-15*2-3*2-7-6)/(this.zoomMaxStep-this.zoomCurStep);if(e.zoomCurStep<e.zoomMaxStep){var n=e.transX;var r=e.transY;var i=e.scale;e.transX-=(e.width/e.scale-e.width/(e.scale*e.zoomStep))/2;e.transY-=(e.height/e.scale-e.height/(e.scale*e.zoomStep))/2;e.setScale(e.scale*e.zoomStep);e.zoomCurStep++;jQuery("#zoomSlider").css("top",parseInt(jQuery("#zoomSlider").css("top"),10)-t);e.container.trigger("zoomIn")}},zoomOut:function(){var e=this;var t=(jQuery("#zoom").innerHeight()-6*2-15*2-3*2-7-6)/(this.zoomMaxStep-this.zoomCurStep);if(e.zoomCurStep>1){var n=e.transX;var r=e.transY;var i=e.scale;e.transX+=(e.width/(e.scale/e.zoomStep)-e.width/e.scale)/2;e.transY+=(e.height/(e.scale/e.zoomStep)-e.height/e.scale)/2;e.setScale(e.scale/e.zoomStep);e.zoomCurStep--;jQuery("#zoomSlider").css("top",parseInt(jQuery("#zoomSlider").css("top"),10)+t);e.container.trigger("zoomOut")}},setScale:function(e){this.scale=e;this.applyTransform()},getCountryId:function(e){return"jqvmap"+this.index+"_"+e},getPinId:function(e){return this.getCountryId(e)+"_pin"},placePins:function(e,t){var n=this;if(!t||t!="content"&&t!="id"){t="content"}if(t=="content"){jQuery.each(e,function(e,t){if(jQuery("#"+n.getCountryId(e)).length==0){return}var r=n.getPinId(e);if(jQuery("#"+r).length>0){jQuery("#"+r).remove()}n.container.append('<div id="'+r+'" for="'+e+'" class="jqvmap_pin" style="position:absolute">'+t+"</div>")})}else{jQuery.each(e,function(e,t){if(jQuery("#"+n.getCountryId(e)).length==0){return}var r=n.getPinId(e);if(jQuery("#"+r).length>0){jQuery("#"+r).remove()}n.container.append('<div id="'+r+'" for="'+e+'" class="jqvmap_pin" style="position:absolute"></div>');jQuery("#"+r).append(jQuery("#"+t))})}this.positionPins();if(!this.pinHandlers){this.pinHandlers=true;var r=function(){n.positionPins()};this.container.bind("zoomIn",r).bind("zoomOut",r).bind("drag",r)}},positionPins:function(){var e=this;var t=this.container.find(".jqvmap_pin");jQuery.each(t,function(t,n){n=jQuery(n);var r=e.getCountryId(n.attr("for"));var i=jQuery("#"+r);var s=document.getElementById(r).getBBox();var o=i.position();var u=e.scale;var a=o.left+s.width/2*u-n.width()/2,f=o.top+s.height/2*u-n.height()/2;n.css("left",a).css("top",f)})},getPin:function(e){var t=jQuery("#"+this.getPinId(e));return t.html()},getPins:function(){var pins=this.container.find(".jqvmap_pin");var ret=new Object;jQuery.each(pins,function(index,pinObj){pinObj=jQuery(pinObj);var cc=pinObj.attr("for");var pinContent=pinObj.html();eval("ret."+cc+"=pinContent")});return JSON.stringify(ret)},removePin:function(e){jQuery("#"+this.getPinId(e)).remove()},removePins:function(){this.container.find(".jqvmap_pin").remove()}};WorldMap.xlink="http://www.w3.org/1999/xlink";WorldMap.mapIndex=1;WorldMap.maps={};var ColorScale=function(e,t,n,r){if(e){this.setColors(e)}if(t){this.setNormalizeFunction(t)}if(n){this.setMin(n)}if(n){this.setMax(r)}};ColorScale.prototype={colors:[],setMin:function(e){this.clearMinValue=e;if(typeof this.normalize==="function"){this.minValue=this.normalize(e)}else{this.minValue=e}},setMax:function(e){this.clearMaxValue=e;if(typeof this.normalize==="function"){this.maxValue=this.normalize(e)}else{this.maxValue=e}},setColors:function(e){for(var t=0;t<e.length;t++){e[t]=ColorScale.rgbToArray(e[t])}this.colors=e},setNormalizeFunction:function(e){if(e==="polynomial"){this.normalize=function(e){return Math.pow(e,.2)}}else if(e==="linear"){delete this.normalize}else{this.normalize=e}this.setMin(this.clearMinValue);this.setMax(this.clearMaxValue)},getColor:function(e){if(typeof this.normalize==="function"){e=this.normalize(e)}var t=[];var n=0;var r;for(var i=0;i<this.colors.length-1;i++){r=this.vectorLength(this.vectorSubtract(this.colors[i+1],this.colors[i]));t.push(r);n+=r}var s=(this.maxValue-this.minValue)/n;for(i=0;i<t.length;i++){t[i]*=s}i=0;e-=this.minValue;while(e-t[i]>=0){e-=t[i];i++}var o;if(i==this.colors.length-1){o=this.vectorToNum(this.colors[i]).toString(16)}else{o=this.vectorToNum(this.vectorAdd(this.colors[i],this.vectorMult(this.vectorSubtract(this.colors[i+1],this.colors[i]),e/t[i]))).toString(16)}while(o.length<6){o="0"+o}return"#"+o},vectorToNum:function(e){var t=0;for(var n=0;n<e.length;n++){t+=Math.round(e[n])*Math.pow(256,e.length-n-1)}return t},vectorSubtract:function(e,t){var n=[];for(var r=0;r<e.length;r++){n[r]=e[r]-t[r]}return n},vectorAdd:function(e,t){var n=[];for(var r=0;r<e.length;r++){n[r]=e[r]+t[r]}return n},vectorMult:function(e,t){var n=[];for(var r=0;r<e.length;r++){n[r]=e[r]*t}return n},vectorLength:function(e){var t=0;for(var n=0;n<e.length;n++){t+=e[n]*e[n]}return Math.sqrt(t)}};ColorScale.arrayToRgb=function(e){var t="#";var n;for(var r=0;r<e.length;r++){n=e[r].toString(16);t+=n.length==1?"0"+n:n}return t};ColorScale.rgbToArray=function(e){e=e.substr(1);return[parseInt(e.substr(0,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(4,2),16)]}})(jQuery)
